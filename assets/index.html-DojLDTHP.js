import{_ as s,c as i,b as a,o as n}from"./app-mHmDy0wZ.js";const l={};function t(d,e){return n(),i("div",null,[...e[0]||(e[0]=[a(`<p>先手动下载nezha-agent程序</p><p>我们打开这个链接：https://github.com/nezhahq/agent/releases ，找到和我们系统对应的安装程序。</p><blockquote><p>我这个是amd64的，所以我就下载对应的 nezha-agent_linux_amd64.zip,下载下来后进行解压，拿到里面的nezha-agent文件，我们随便找个地方上传上去。</p></blockquote><p>用ssh工具连接你的服务器，切换到root用户</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>sudo -i</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然后进入到cd到你上传文件的位置，执行下面的命令可以查看帮助：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>./nezha-agent</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果输出的是：-bash: ./nezha-agent: No such file or directory，则表示没有权限，我们需要赋权一下，执行下面的命令：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>chmod +x nezha-agent</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然后，在继续执行</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>./nezha-agent</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>启动被控端agent</p><p>下面我们就可以启动了，输入</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>./nezha-agent -s 面板域名/IP:面板端口 -p 秘钥</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>面板域名：哪吒面板通讯的域名/IP</p><p>面板端口：默认是5555，要是改了的话就按照改后的</p><p>秘钥，从面板上创建的服务器，都有个秘钥，复制下来即可。</p><p>执行完命令之后，我们就可以从服务端看到服务器的情况了。</p><h4 id="配置服务" tabindex="-1"><a class="header-anchor" href="#配置服务"><span>配置服务</span></a></h4><p>上面的这种方法虽然可以看到服务器的情况了，但是我们关闭ssh之后，就看不到了，所以，我们需要把该启动命令配置成服务，让服务器一开机就执行该命令</p><p>进入到 /usr/lib/systemd/system/目录下，我们执行创建个名字为：nezha-agent.service的服务文件。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>cd /usr/lib/systemd/system/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>touch nezha-agent.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>使用vi命令，写入如下信息</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>Description=哪吒探针监控端</span></span>
<span class="line"><span>ConditionFileIsExecutable=/root/nezha-agent</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Service]</span></span>
<span class="line"><span>StartLimitInterval=5</span></span>
<span class="line"><span>StartLimitBurst=10</span></span>
<span class="line"><span>ExecStart=/root/nezha-agent &quot;-s&quot; &quot;xxxx.com:5555&quot; &quot;-p&quot; &quot;xxx&quot;</span></span>
<span class="line"><span>WorkingDirectory=/root</span></span>
<span class="line"><span>Restart=always</span></span>
<span class="line"><span>RestartSec=120</span></span>
<span class="line"><span>EnvironmentFile=-/etc/sysconfig/nezha-agent</span></span>
<span class="line"><span>[Install]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>WantedBy=multi-user.target</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意ExecStart的值，一定是你nezga-agent文件的全路径+执行命令，比如我的是：/root/nezha-agent -s 面板域名:面板端口 -p 秘钥</p><p>然后保存文件即可。</p><p>加载配置文件</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>systemctl daemon-reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>设置服务自启动</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>systemctl enable nezha-agent4</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>启动服务</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>systemctl start nezha-agent</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>查看服务的启动状态</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>systemctl status nezha-agent</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>启动成功</p>`,36)])])}const h=s(l,[["render",t]]),c=JSON.parse('{"path":"/blog/j3rm7hip/","title":"群晖安装Agent被控端","lang":"zh-CN","frontmatter":{"title":"群晖安装Agent被控端","createTime":"2025/10/13 22:35:13","permalink":"/blog/j3rm7hip/","tags":["backup"]},"readingTime":{"minutes":1.83,"words":549},"git":{"createdTime":1761750197000,"updatedTime":1761826529000,"contributors":[{"name":"deerwan","username":"deerwan","email":"sunfulai123@gmail.com","commits":2,"avatar":"https://avatars.githubusercontent.com/deerwan?v=4","url":"https://github.com/deerwan"}]},"filePathRelative":"blog/backup/群晖安装Agent被控端.md","headers":[],"categoryList":[{"id":"402051","sort":10001,"name":"backup"}]}');export{h as comp,c as data};
